(this["webpackJsonprunning-stats"]=this["webpackJsonprunning-stats"]||[]).push([[1],{13:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var r=n(2),a=n.n(r),c=n(4),s=function(e,t,n){var r=new URL("https://www.strava.com/oauth/authorize"),a=r.searchParams;return a.append("client_id",e),a.append("redirect_uri",t),a.append("response_type","code"),a.append("scope","activity:read"),n&&a.append("state",n),r.toString()},i=function(){var e=Object(c.a)(a.a.mark((function e(t,n,r){var c,s,i,o,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(c=new URLSearchParams).append("client_id",t),c.append("client_secret",n),c.append("code",r),c.append("grant_type","authorization_code"),e.next=7,fetch("https://www.strava.com/oauth/token",{method:"POST",body:c});case 7:if((s=e.sent).ok){e.next=13;break}return e.next=11,s.text();case 11:throw i=e.sent,new Error("Unknown error while getting initial Strava auth tokens. "+i);case 13:return e.next=15,s.json();case 15:return o=e.sent,u={expiresAt:new Date(1e3*o.expires_at),refreshToken:o.refresh_token,accessToken:o.access_token,info:{firstName:o.athlete.firstname,lastName:o.athlete.lastname}},e.abrupt("return",u);case 18:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),o=function(){var e=Object(c.a)(a.a.mark((function e(t,n,r){var c,s,i,o,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(c=new URLSearchParams).append("client_id",t),c.append("client_secret",n),c.append("refresh_token",r),c.append("grant_type","refresh_token"),e.next=7,fetch("https://www.strava.com/oauth/token",{method:"POST",body:c});case 7:if((s=e.sent).ok){e.next=13;break}return e.next=11,s.text();case 11:throw i=e.sent,new Error("Unknown error while refreshing Strava auth tokens: "+i);case 13:return e.next=15,s.json();case 15:return o=e.sent,u={expiresAt:new Date(1e3*o.expires_at),refreshToken:o.refresh_token,accessToken:o.access_token},e.abrupt("return",u);case 18:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},21:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return l}));var r=n(14),a=n(2),c=n.n(a),s=n(4),i=n(13),o=n(6),u=function(){var e=Object(s.a)(c.a.mark((function e(t){var n,r,a,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h();case 2:return n=e.sent,(r=new URL("https://www.strava.com/api/v3/athlete/activities")).searchParams.append("page",t.toString()),e.next=7,fetch(r.toString(),{headers:{Authorization:"Bearer ".concat(n.session.accessToken)}});case 7:if(!(a=e.sent).ok){e.next=13;break}return e.next=11,a.json();case 11:return s=e.sent,e.abrupt("return",s);case 13:return e.abrupt("return",d(a));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=Object(s.a)(c.a.mark((function e(t){var n,r,a,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h();case 2:return n=e.sent,r="https://www.strava.com/api/v3/activities/".concat(t),e.next=6,fetch(r,{headers:{Authorization:"Bearer ".concat(n.session.accessToken)}});case 6:if(!(a=e.sent).ok){e.next=12;break}return e.next=10,a.json();case 10:return s=e.sent,e.abrupt("return",s);case 12:return e.abrupt("return",d(a));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(e){throw new Error("Strava API error. Status: "+e.status)},h=function(){var e=Object(s.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.a)();case 2:if((null===(t=e.sent)||void 0===t?void 0:t.client)&&(null===t||void 0===t?void 0:t.session)){e.next=5;break}throw new Error("No active Strava session found.");case 5:if(!(t.session.expiresAt<new Date)){e.next=9;break}return e.next=8,p();case 8:return e.abrupt("return",e.sent);case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=function(){var e=Object(s.a)(c.a.mark((function e(){var t,n,a,s,u,l,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.a)();case 2:if((null===(t=e.sent)||void 0===t?void 0:t.client)&&(null===t||void 0===t?void 0:t.session)){e.next=5;break}throw new Error("No active Strava session found.");case 5:return n=t.client,a=n.id,s=n.secret,u=t.session.refreshToken,e.next=9,Object(i.b)(a,s,u);case 9:return l=e.sent,d={client:t.client,session:Object(r.a)(Object(r.a)({},t.session),l)},e.next=13,Object(o.b)(d);case 13:return e.abrupt("return",d);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},37:function(e,t,n){},38:function(e,t,n){},39:function(e,t,n){},40:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(23),s=n.n(c),i=n(2),o=n.n(i),u=n(4),l=n(13),d=n(3),h=n(9),p=n(6),j=n(0),b=function(e){var t=e.location,n=Object(p.c)(),a=(null===n||void 0===n?void 0:n.client)||{},c=a.id,s=a.secret,i=t.search,b=Object(r.useState)(!1),f=Object(h.a)(b,2),v=f[0],x=f[1],O=Object(r.useState)(""),w=Object(h.a)(O,2),m=w[0],k=w[1];return Object(r.useEffect)((function(){Object(u.a)(o.a.mark((function e(){var t,n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new URLSearchParams(i),n=t.get("error"),r=t.get("code"),!n){e.next=6;break}return k(n),e.abrupt("return");case 6:if(!(c&&s&&r)){e.next=13;break}return e.next=9,Object(l.a)(c,s,r);case 9:return a=e.sent,e.next=12,Object(p.b)({client:{id:c,secret:s},session:{refreshToken:a.refreshToken,accessToken:a.accessToken,expiresAt:a.expiresAt,athlete:{id:"",avatarUrl:"",name:"".concat(a.info.firstName," ").concat(a.info.lastName)}}});case 12:x(!0);case 13:case"end":return e.stop()}}),e)})))()}),[c,s,i]),m?Object(j.jsxs)("p",{children:["Error during authentication with Strava: ",Object(j.jsx)("code",{children:m})]}):v?Object(j.jsx)(d.a,{to:"/settings"}):null},f=n(14),v=n(25),x=0,O=function(){return"id-".concat(++x)},w=(n(37),function(e){var t=e.children,n=Object(v.a)(e,["children"]),a=function(){var e=Object(r.useState)(O);return Object(h.a)(e,1)[0]}(),c=Object(r.useState)(!1),s=Object(h.a)(c,1)[0]?"text":n.type;return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("label",{htmlFor:n.id||a,children:t}),Object(j.jsx)("input",Object(f.a)(Object(f.a)({},n),{},{type:s,id:n.id||a}))]})}),m=function(){var e,t,n=Object(p.c)(),r=Object(d.g)();return console.log("auth:",n),Object(j.jsxs)("form",{style:{display:"flex",flexDirection:"column",maxWidth:"500px"},onSubmit:function(e){e.preventDefault();var t=new FormData(e.target),n=t.get("clientId").toString().trim(),r=t.get("clientSecret").toString().trim();Object(u.a)(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(p.b)({client:{id:n,secret:r}});case 2:t="".concat(window.location.href,"/strava-auth-return"),a=Object(l.c)(n,t),window.location.href=a;case 5:case"end":return e.stop()}}),e)})))()},children:[Object(j.jsx)("h2",{children:"Settings"}),Object(j.jsx)("h3",{children:"Strava API Client"}),Object(j.jsx)(w,{required:!0,name:"clientId",defaultValue:null===n||void 0===n||null===(e=n.client)||void 0===e?void 0:e.id,children:"Client ID"}),Object(j.jsx)(w,{required:!0,name:"clientSecret",type:"password",defaultValue:null===n||void 0===n||null===(t=n.client)||void 0===t?void 0:t.secret,children:"Client Secret"}),Object(j.jsx)("button",{type:"submit",children:"Save and connect"}),!(null===n||void 0===n?void 0:n.session)&&Object(j.jsxs)("div",{children:[Object(j.jsx)("p",{children:"The app is not currently connected to strava. Enter your API credentials and connect. You will be prompted to link your account with this app, allowing it to access the Strava API."}),Object(j.jsxs)("p",{children:["This app has no back-end so you will need to"," ",Object(j.jsx)("a",{href:"https://www.strava.com/settings/api",children:"configure your own Strava API application"}),". Make sure that the ",Object(j.jsx)("i",{children:"Authorization Callback Domain"})," is set to"," ",Object(j.jsx)("code",{children:window.location.host})," or authorization will not work."]}),Object(j.jsxs)("p",{children:["Please"," ",Object(j.jsx)("a",{href:"https://www.strava.com/legal/api",children:"read the Strava API Agreement"})," ","before entering your client id and secret into the application. The creator(s) of this software are not responsible for what you do with it and will not be held accountable if Strava revokes your access to their API if they were to judge that this is not a correct use of it. Note that no data retrieved from the API will be stored anywhere other than on the browser for caching purposes."]})]}),(null===n||void 0===n?void 0:n.session)&&Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("h3",{children:"Strava API Session"}),Object(j.jsx)(w,{readOnly:!0,value:null===n||void 0===n?void 0:n.session.athlete.name,children:"Display Name"}),Object(j.jsx)(w,{type:"password",readOnly:!0,value:null===n||void 0===n?void 0:n.session.accessToken,children:"Access Token"}),Object(j.jsx)(w,{readOnly:!0,value:null===n||void 0===n?void 0:n.session.expiresAt.toISOString(),children:"Expires At"}),Object(j.jsx)(w,{type:"password",readOnly:!0,value:null===n||void 0===n?void 0:n.session.refreshToken,children:"Refresh Token"}),Object(j.jsx)("button",{type:"button",onClick:function(){Object(p.b)(void 0)},children:"Clear Strava session and all cached data"})]}),Object(j.jsx)(d.b,{path:"".concat(r.path,"/strava-auth-return"),component:b})]})},k=n(11),g=(n(38),function(){var e=Object(p.c)();return Object(j.jsxs)("header",{className:"app-header",children:[Object(j.jsxs)("nav",{children:[Object(j.jsx)("h1",{children:"Running Stats"}),Object(j.jsxs)("ul",{children:[Object(j.jsx)("li",{children:Object(j.jsx)(k.c,{to:"/activities",children:"Activities"})}),Object(j.jsx)("li",{children:Object(j.jsx)(k.c,{to:"/maps",children:"Maps"})}),Object(j.jsx)("li",{children:Object(j.jsx)(k.c,{to:"/settings",children:"Settings"})})]})]}),Object(j.jsxs)("div",{className:"strava-status",children:[!(null===e||void 0===e?void 0:e.session)&&"Not connected",(null===e||void 0===e?void 0:e.session)&&e.session.athlete.name]})]})}),y=function(e){var t=e.page,n=e.onOpenPage,r=e.canOpenNextPage,a=e.canOpenPreviousPage;return Object(j.jsxs)("div",{children:[Object(j.jsx)("button",{disabled:!a,onClick:function(){return n(t-1)},children:"Previous"}),Object(j.jsxs)("span",{style:{margin:"1rem"},children:["Page ",t]}),Object(j.jsx)("button",{disabled:!r,onClick:function(){return n(t+1)},children:"Next"})]})},S=n(21),P=function(){var e=Object(r.useState)(),t=Object(h.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(1),s=Object(h.a)(c,2),i=s[0],l=s[1];return Object(r.useEffect)((function(){Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.b(i);case 2:t=e.sent,a(t);case 4:case"end":return e.stop()}}),e)})))()}),[i]),Object(j.jsxs)("div",{children:[Object(j.jsx)("h2",{children:"Activities"}),Object(j.jsx)(y,{page:i,onOpenPage:l,canOpenPreviousPage:i>1,canOpenNextPage:!!n&&n.length>0}),Object(j.jsx)("ul",{children:null===n||void 0===n?void 0:n.map((function(e){return Object(j.jsxs)("li",{children:[Object(j.jsx)(k.b,{to:"/activities/".concat(e.id),children:e.name})," (",Math.round(e.distance/1e3)," km)"]},e.id)}))}),!n&&Object(j.jsx)("p",{children:"loading..."}),n&&!n.length&&Object(j.jsx)("p",{children:"No more results"})]})},A=(n(39),function(){return Object(j.jsx)("footer",{className:"app-footer",children:Object(j.jsx)("a",{href:"https://www.strava.com",children:Object(j.jsx)("img",{alt:"Powered by Strava",src:"".concat("/running-stats","/powered-by-strava.svg"),style:{height:"2rem"}})})})}),T=Object(r.lazy)((function(){return Promise.all([n.e(0),n.e(5)]).then(n.bind(null,76))})),_=Object(r.lazy)((function(){return Promise.all([n.e(0),n.e(4)]).then(n.bind(null,74))})),N=function(){return Object(j.jsxs)(k.a,{children:[Object(j.jsxs)("div",{className:"app-content-without-footer",children:[Object(j.jsx)(g,{}),Object(j.jsx)(r.Suspense,{fallback:Object(j.jsx)("p",{children:"Loading..."}),children:Object(j.jsxs)(d.d,{children:[Object(j.jsx)(d.b,{exact:!0,path:"/",render:function(){return Object(j.jsx)(d.a,{to:"/settings"})}}),Object(j.jsx)(d.b,{path:"/settings",component:m}),Object(j.jsx)(d.b,{path:"/activities/:id",component:_}),Object(j.jsx)(d.b,{path:"/activities",component:P}),Object(j.jsx)(d.b,{path:"/maps",component:T})]})})]}),Object(j.jsx)(A,{})]})},I=(n(40),function(e){e&&e instanceof Function&&n.e(6).then(n.bind(null,75)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),c(e),s(e)}))});s.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(N,{})}),document.getElementById("root")),I()},6:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return d}));var r=n(9),a=n(2),c=n.n(a),s=n(4),i=n(18),o=n(1),u=function(){var e=Object(s.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.a)("strava-auth");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=function(){var e=Object(s.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)("strava-auth",t);case 2:h.forEach((function(e){return(0,e.callback)()}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(o.useState)(),t=Object(r.a)(e,2),n=t[0],a=t[1];return Object(o.useEffect)((function(){var e=!1,t=function(){var t=Object(s.a)(c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u();case 2:n=t.sent,e||a(n);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t();var n=function(e){var t={callback:e};return h.push(t),function(){var e=h.findIndex((function(e){return e===t}));e>=0&&h.splice(e,1)}}(t);return function(){n(),e=!0}}),[]),n},h=[]}},[[41,2,3]]]);
//# sourceMappingURL=main.84558c73.chunk.js.map